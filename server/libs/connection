--Server connection stuff:

connections = {}

function handle(ID, message, protocol)
	if protocol == "far:init_connection" and message == "init_connection" then
		handleIncomingConnection(ID, _GLOBAL_TIMEOUT)
	end
end

function handleIncomingConnection(ID, timeout)
	loglib.info("Incoming connection from /"..ID)
	connections[#connections + 1] = {
		client_id = ID,
		authenticated = false,
		session_id = #connections + 1
	}
	rednet.send(ID, 
		{
			sessionId = #connections,
			message = "ok:request_credentials"
		}, "far:init_connection"
	)
end

function waitForMessage(ID, protocol, timeout)
	while true do
		local senderId, message, protocol = rednet.receive(protocol, timeout)
		if not senderId then loglib.error("Connection with client ID:"..ID.." timed out.")
			break
		end
		if senderId == ID then
			return message
		end
	end
end