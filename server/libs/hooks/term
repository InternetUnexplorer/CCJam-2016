local native = (term.native and term.native()) or term
local redirectTarget = native
local connection = ({...})[1]

local win = window.create( native, 1, 1, connection.size_x, connection.size_y, false )

local term = {}
 
term.redirect = function( target )
    native.redirect( target )
end
 
term.current = function()
    return redirectTarget
end
 
term.native = function()
    -- NOTE: please don't use this function unless you have to.
    -- If you're running in a redirected or multitasked enviorment, term.native() will NOT be
    -- the current terminal when your program starts up. It is far better to use term.current()
    return native
end

term.isColor = function()
	return connection.is_color
end

term.isColour = function()
	return term.isColor()
end

term.setBackgroundColor = function( color )
	win.setBackgroundColor( color )
	connection.sendUpdate(
		{
			t = 1,
			c = color
		}
	)
end

term.setBackgroundColour = function( colour )
	term.setBackgroundColor( color )
end

term.setTextColor = function( color )
	win.setTextColor( color )
	connection.sendUpdate(
		{
			t = 2,
			c = color
		}
	)
end

term.setTextColour = function( colour )
	term.setTextColor( colour )
end

term.getTextColor = function()
	return win.getTextColor()
end

term.getTextColour = function()
	return term.getTextColor()
end

term.getBackgroundColor = function()
	return win.getBackgroundColor()
end

term.getBackgroundColour = function()
	return term.getBackgroundColor()
end

term.setCursorBlink = function( bool )
	win.setCursorBlink( bool )
	connection.sendUpdate(
		{
			t = 3,
			b = bool
		}
	)
end

term.setCursorPos = function( x, y )
	win.setCursorPos( x, y )
	connection.sendUpdate(
		{
			t = 4,
			x = x,
			y = y
		}
	)
end

term.blit = function( text, fg, bg )
	win.blit( text, fg, bg )
	connection.sendUpdate(
		{
			t = 5,
			tx = text,
			f = fg,
			b = bg
		}
	)
end

term.getSize = function()
	return win.getSize()
end

term.write = function( string )
	win.write( string )
	connection.sendUpdate(
		{
			t = 6,
			s = string
		}
	)

end

term.clearLine = function()
	win.clearLine()
	connection.sendUpdate(
		{
			t = 7
		}
	)
end

term.getCursorPos = function()
	return win.getCursorPos()
end

term.scroll = function( n )
	win.scroll( n )
	connection.sendUpdate(
		{
			t = 8,
			n = n
		}
	)
end

term.clear = function()
	win.clear()
	connection.sendUpdate(
		{
			t = 9
		}
	)
end

return term